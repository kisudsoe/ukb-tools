---
title: "Deathrate"
author: "Jinhee Chang"
date: "9/23/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Ultimate Goal: Create death incidence rate and frequency

```{r}

# Load the data that I am going to use
deathfile <- readRDS("Deathfile.rds")

# Check how this data looks like
head(deathfile)

```

## Calculate death incidence rate as a whole
library(tidyr)
library(dplyr)
library(data.table)

```{r}

# Select patient ID, Ageatdeath, and Diseasecode
deathrate <- deathfile %>% select(1,2,4)

# Check how the data looks like
head(deathrate)

# Check if there is any NA in ageatdeath
which(is.na(deathrate$Ageatdeath)) # none

```

## Check the age range of the "deathrate"

```{r}
# Check the age distribution of deathfile patients
hist(deathrate$Ageatdeath, breaks = 50)

# Check the minimum age and maximum age of the data
min(deathrate$Ageatdeath) # 40
max(deathrate$Ageatdeath) # 81

```

## Calculate age frequency and incidence rate by age range
library(plyr)

```{r}
# make deathage range data frame
my.summary <- data.frame(age.lo = c(39:80), 
                         age.hi = c(40:81))

# Get deathage range frequency data
deathage_freq <- adply(my.summary, 1, transform, freq = 
                    sum(deathrate$Ageatdeath > age.lo
                    & deathrate$Ageatdeath <= age.hi))

# Make a new column name age_range and add age.lo and age.hi into one column
deathage_freq$age_range <- paste0(deathage_freq$age.lo, " - ", deathage_freq$age.hi)
# Leave only age_range and frequency column
deathage_freq <- deathage_freq %>% select(4,3)

# Add incidence rate to the data
deathage_freq$incidence_rate <- deathage_freq$freq/sum(deathage_freq$freq)

# Check how this data looks like
deathage_freq

```
## Create Plot of deathage_freq
library(ggplot2)

```{r}

# line plot of deathage_freq
ggplot(data = deathage_freq, aes(x = as.factor(age_range), y = incidence_rate, group = 1))+
  geom_line()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title= "Death Frequency",
                      y="Incidence Rate", x = "Age Range")

```

## Only select Alzheimer Disease death rate

# Primary cause of death - Fid: 40001
G30 Alzheimer's disease                     -
G30.0 Alzheimer's disease with early onset  6
G30.1 Alzheimer's disease with late onset   14
G30.9 Alzheimer's disease, unspecified      348

# Secondary cause of death - Fid: 40002
G30 Alzheimer's disease                       -
G30.0 Alzheimer's disease with early onset    2
G30.1 Alzheimer's disease with late onset     13
G30.9 Alzheimer's disease, unspecified        150

```{r}

# Only select patient who's cause of death is Alzheimer Disease 
AD_death <- deathrate[grep("G30", deathrate$Diseasecode), ]

# Majority of them is G309
all(AD_death$Diseasecode == "G309") # False
# There is 3 people who is not G309
AD_death[which(AD_death$Diseasecode != "G309"), ]

# Check how the data looks like
head(AD_death)

```
## Check the age range of the Alzheimer Disease death rate

```{r}

# Check the age distribution of deathfile patients
hist(AD_death$Ageatdeath, breaks = 50)

# Check the minimum age and maximum age of the data
min(AD_death$Ageatdeath) # 60
max(AD_death$Ageatdeath) # 81

```

## Calculate age frequency and incidence rate by age range


```{r}
# make deathage range data frame
my.summary <- data.frame(age.lo = c(59:80), 
                         age.hi = c(60:81))

# Get deathage range frequency data
AD_death_freq <- adply(my.summary, 1, transform, freq = 
                    sum(AD_death$Ageatdeath > age.lo
                    & AD_death$Ageatdeath <= age.hi))

# Make a new column name age_range and add age.lo and age.hi into one column
AD_death_freq$age_range <- paste0(AD_death_freq$age.lo, " - ", AD_death_freq$age.hi)
# Leave only age_range and frequency column
AD_death_freq <- AD_death_freq %>% select(4,3)

# Add incidence rate to the data
AD_death_freq$incidence_rate <- AD_death_freq$freq/sum(AD_death_freq$freq)

# Check how this data looks like
AD_death_freq

```
## Create Plot of deathage_freq
library(ggplot2)

```{r}

# line plot of deathage_freq
ggplot(data = AD_death_freq, aes(x = as.factor(age_range), y = incidence_rate, group = 1))+
  geom_line()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title= "AD Death Frequency (n=162)",
                      y="Incidence Rate", x = "Age Range")

```
